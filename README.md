Depth 카메라 기반 자율주행 자동차
==================================
프로젝트명: DEPTH CAMERA를 이용한 자율주행 RC카

기간: 2024.03.11 – 2024.12.03

참여 인원: 3


개요

기존 RC카 기반 자율주행 실습에서 단순한 하드코딩 방식이나 정밀도 낮은 센서를 사용하는 것에 한계를 느껴, 보다 실제 자율주행 차량에 가까운 구조를 구현하고자 본 프로젝트를 기획하였습니다. Jetson Nano의 연산 성능과 OAK-D Pro의 Depth 인식 능력을 활용하여 차선 추적, 신호등 인식, 장애물 회피 기능을 통합적으로 구현하였고, 아두이노를 통해 차량 제어를 정밀하게 수행하였습니다. 이 구조는 향후 라이다 연동, 실내외 자율배송 시스템, 스마트시티 모빌리티 기술로의 확장이 가능합니다.

기술 환경

● 운영체제: Ubuntu 20.04 (Jetson Nano)

● 개발 언어: Python (OpenCV, DepthAI, YOLOv8)

● 하드웨어: 
  - Jetson Nano (메인 연산 장치)
  - Arduino (차량 제어)
  - OAK-D Pro Depth 카메라 (RGB + Depth 정보)
  - RC Monster Truck (3D 프린터를 이용해 고정 부품 제작)

● 영상 처리:
  - Gaussian Blur, Canny Edge Detection, Hough Line Transform
  - Hough Circle Transform (원형 신호 감지)
  - YOLOv8 (객체 인식, 신호등/장애물 검출)

● 통신: Jetson ↔ Arduino 간 USB 직렬 통신

● 개발 방식: VSCode Remote SSH 연결을 통한 원격 개발

담당 역할: 라인 트레이싱 알고리즘 구현, 장애물 인식 및 회피 제어 로직 구현

주요 기능 및 구현 과정

Jetson Nano, Arduino, OAK-D Pro 카메라, 몬스터트럭 RC카, 3D 프린터를 활용하여 자율주행 하드웨어를 설계 및 제작하였고, 소프트웨어는 Jetson에서 연산을 수행하고 Arduino로 제어 명령을 전송하여 차량을 제어하는 구조로 구성했습니다. SSH 기반 원격 개발환경에서 Python으로 코딩하며 시스템을 최적화했습니다.
Lane Tracing은 Gaussian Blur, Canny Edge Detection, Hough Line Transform 등을 이용하여 차선을 인식하고, 중심선을 기반으로 조향 각도를 계산하여 차량이 차선을 따라 주행할 수 있도록 구현했습니다.
또한, YOLOv8 모델을 활용하여 신호등을 인식하고, 이를 바탕으로 차량의 정지 여부를 제어했습니다. 장애물 회피를 위해 DepthAI 모듈로부터 RGB와 Depth 이미지를 수신하고, YOLO 객체 인식을 통해 장애물까지의 거리를 파악하여 특정 거리 이하일 경우 차량을 정지시키는 로직을 개발했습니다.
이러한 자율주행 알고리즘은 Jetson과 Arduino 간 직렬 통신을 통해 실제 RC카에 실시간으로 반영되며, 주행 안정성과 반응 속도를 고려하여 개선을 반복했습니다.

성과 및 배운점

하드웨어의 한계를 소프트웨어로 보완하는 방법을 배웠고, Depth 카메라를 활용하여 장애물을 인식하고 거리를 측정하는 기술을 익혔습니다.


환경
---------
1. 젯슨 나노 os   
   ubuntu 20.04
2. 파이썬 3.10
3. depthai module + python exam code
4. yolo v8 nano   

---------------------------------------

serial_arduino.py
-----------------
젯슨 나노가 아두이노랑 통신하기 위한 코드.

drive.py
----------
아래의 코드로 가져온 정보들로 차량의 각도와 속도 결정.

camera_class.py
---------------
depthai module 이용하여 oak-d pro 카메라에서 원하는 이미지와 정보를 가져오는 코드.

line_tracing.py
----------------
차선 2개를 찾아서 각 차선의 각도를 이용하여 차선 중앙을 기준으로 차량이 움직여야할 각도 생성.
차선을 1개만 찾는 경우 보정하는 코드 작동.

obstacle_detection.py
--------------------
camera_class에서 가져온 욜로 탐색 정보, rgb img, depth img를 사용하여 장애물을 인식하고 거리 측정.

traffic_light_detection.py
-------------------------
욜로로 신호등 찾아서 빨강, 주황, 초록 판별.
원을 찾지 않고 픽셀 색으로만 따져서 신호등 상태 판단.

test_files
---------------
이것 저것 기능 테스트 하면서 나온 파일들.
이 코드들의 작동에 대해 적혀있기 때문에 같이 저장.

---------------------------------------------------------------------

하드웨어 설정 미스
--------------------
1. 차량: 내부에서 사용하기에 차량 자체가 너무 컸음.(기존에 외부에서 사용하기 위한 목적으로 구입했기 때문에 방법이 없었음)
2. 카메라: 카메라 기능적으로는 우수했지만 RC카에 달기에는 카메라 각도가 너무 좁음. 드론에 적당해 보임.
3. 배터리: RC카(몬스터트럭) + 좋은 성능의 카메라 + 젯슨 나노 + 아두이노 -> 소모가 너무 심함.

코드 미스
--------------
카메라 각도가 좁아서 차선을 찾지 못한다? 

직진

카메라가 차선을 한 개만 잡는다?

보정치를 더해서 판단.

=> 적당한 해결이 가능했을 것으로 보임.

# depthcamera_self_driving
